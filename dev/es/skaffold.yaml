## Be sure to add the helm repos
## helm repo add datarepo-helm https://broadinstitute.github.io/datarepo-helm && helm repo update
apiVersion: skaffold/v2alpha2
kind: Config
build:
  tagPolicy:
    gitCommit:
      variant: AbbrevCommitSha
  artifacts:
  - image: gcr.io/broad-jade-dev/jade-data-repo
    jib:
      args:
      - jib
      type: gradle
deploy:
  helm:
    flags:
      upgrade:
        - --install
        - --debug
    releases:
    # create secrets
    - name: es-jade-create-secret-manager-secret
      chartPath: datarepo-helm/create-secret-manager-secret
      namespace: es
      remote: true
      valuesFiles:
      - https://raw.githubusercontent.com/broadinstitute/datarepo-helm-definitions/master/dev/es/create-secret-manager-secret.yaml
    # gcp sqlproxy
    - name: es-jade-gcloud-sqlproxy
      chartPath: datarepo-helm/gcloud-sqlproxy
      namespace: es
      remote: true
      valuesFiles:
      - https://raw.githubusercontent.com/broadinstitute/datarepo-helm-definitions/master/dev/es/gcloud-sqlproxy.yaml
    # datarepo-api
    - name: es-jade-datarepo-api
      chartPath: datarepo-helm/datarepo-api
      namespace: es
      remote: true
      values:
        imageName: gcr.io/broad-jade-dev/jade-data-repo
      valuesFiles:
      - https://raw.githubusercontent.com/broadinstitute/datarepo-helm-definitions/master/dev/es/datarepo-api.yaml
    # datarepo-ui
    - name: es-jade-datarepo-ui
      chartPath: datarepo-helm/datarepo-ui
      namespace: es
      remote: true
      valuesFiles:
      - https://raw.githubusercontent.com/broadinstitute/datarepo-helm-definitions/master/dev/es/datarepo-ui.yaml
    # oidc-proxy
    - name: es-jade-oidc-proxy
      chartPath: datarepo-helm/oidc-proxy
      namespace: es
      remote: true
      valuesFiles:
      - https://raw.githubusercontent.com/broadinstitute/datarepo-helm-definitions/master/dev/es/oidc-proxy.yaml
